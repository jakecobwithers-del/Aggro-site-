<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aggro PvP — Donate</title>

  <style>
    @font-face{ font-family:'DayZFont'; src:url('28 Days Later.ttf') format('truetype'); font-display:swap; }
    :root{
      --bg:#000; --accent:#ff3b3b; --card-start:#070707; --card-end:#0f0f0f;
      --card-border:rgba(255,59,59,0.12); --radius:12px; --max-w:1000px; --pad:22px; --smoke:0.66;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:#fff;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;}
    #smoke-bg{position:fixed;inset:0;z-index:0;pointer-events:none;overflow:hidden}
    #smoke-bg video{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:160vw;height:160vh;object-fit:cover;opacity:var(--smoke);filter:blur(5px) saturate(1.04) contrast(1.02);}
    .page{position:relative;z-index:2;min-height:100vh;display:flex;align-items:flex-start;justify-content:center;padding:6vh 20px 80px;box-sizing:border-box;}
    .container{width:100%;max-width:var(--max-w);display:flex;flex-direction:column;gap:18px;}
    .site-title{margin:0;font-family:'DayZFont',sans-serif;font-size:clamp(30px,6vw,68px);text-transform:uppercase;letter-spacing:1.6px;color:#fff;text-align:center;text-shadow:0 1px 0 rgba(0,0,0,0.85),0 8px 28px rgba(0,0,0,0.6),0 12px 40px rgba(255,59,59,0.04);}
    .card{background:linear-gradient(180deg,var(--card-start),var(--card-end));border-radius:var(--radius);border:2px solid var(--card-border);padding:var(--pad);box-shadow:inset 0 2px 6px rgba(255,255,255,0.02),inset 0 -8px 18px rgba(0,0,0,0.75),0 12px 30px rgba(0,0,0,0.9);}
    .card h2{margin:0 0 8px 0;font-family:'DayZFont',sans-serif;color:var(--accent);font-size:clamp(18px,3.6vw,28px);letter-spacing:.8px;text-transform:uppercase;}
    .card p{margin:0 0 12px 0;color:rgba(255,255,255,0.94);line-height:1.6;font-size:15px;}
    .donate-btn{display:inline-block;margin-top:12px;padding:12px 24px;border-radius:10px;background:var(--accent);color:#fff;font-weight:800;text-decoration:none;}
    .back-row{display:flex;justify-content:center;margin-top:6px;}
    .back-link{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;border-radius:12px;background:linear-gradient(180deg,#0b0b0b,#121212);border:2px solid rgba(255,59,59,0.14);color:var(--accent);text-decoration:none;font-weight:800;}
    #audio-debug{display:none;position:fixed;left:50%;transform:translateX(-50%);top:14vh;background:#a21b1b;color:#fff;padding:10px 14px;border-radius:8px;border:2px solid #600d0d;z-index:9999;font-weight:700;}
    #tap-overlay{display:none;position:fixed;inset:0;z-index:9998;cursor:pointer;background:linear-gradient(transparent 70%, rgba(0,0,0,0.35));}
    #tap-hint{position:fixed;left:50%;top:18vh;transform:translateX(-50%);z-index:9999;background:rgba(0,0,0,0.6);color:#fff;padding:8px 12px;border-radius:8px;font-weight:700;border:1px solid rgba(255,255,255,0.06);font-size:14px;display:none;}
    @media(max-width:520px){ .site-title{font-size:clamp(22px,10vw,40px);} .card{padding:14px;} }
  </style>
</head>
<body>
  <div id="smoke-bg" aria-hidden="true">
    <video autoplay loop muted playsinline preload="auto" poster="smoke-poster.jpg">
      <source src="Smoke.webm" type="video/webm">
      <source src="Smoke.mp4" type="video/mp4">
    </video>
  </div>

  <main class="page" role="main">
    <div class="container">
      <header class="site-header"><h1 class="site-title">Donate</h1></header>

      <section class="card" aria-labelledby="why-donate">
        <h2 id="why-donate">Why Donate?</h2>
        <p>Running Aggro PvP takes time, effort, and real-world costs. Donations help keep the server online, pay for hosting, add new mods, and develop fresh content.</p>
      </section>

      <section class="card" aria-labelledby="how-it-helps">
        <h2 id="how-it-helps">How It Helps</h2>
        <ul>
          <li>Server hosting and performance upgrades</li>
          <li>Development of custom mods & events</li>
          <li>Visuals, UI, and branding</li>
          <li>Community prizes and events</li>
        </ul>
      </section>

      <section class="card" aria-labelledby="how-to-donate">
        <h2 id="how-to-donate">How to Donate</h2>
        <p>If you’d like to support us, click the button below. Every bit helps keep Aggro PvP alive and improving.</p>
        <div><a class="donate-btn" href="YOUR_DONATION_LINK_HERE">Donate Now</a></div>
      </section>

      <div class="back-row"><a class="back-link" href="index.html" aria-label="Return to main menu">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" aria-hidden="true" style="stroke:currentColor;stroke-width:2;stroke-linecap:round;stroke-linejoin:round;"><path d="M19 12H5"></path><path d="M12 19l-7-7 7-7"></path></svg>
        Return to Main Menu
      </a></div>
    </div>
  </main>

  <div id="audio-debug" role="status" aria-live="assertive"></div>
  <div id="tap-overlay" aria-hidden="true"></div>
  <div id="tap-hint">Tap anywhere to enable audio</div>

  <script>
  (function(){
    // CONFIG
    const AUDIO_URL = 'https://jakecobwithers-del.github.io/Aggro-site-/Donate.mp3';
    const START_DELAY_MS = 900;   // wait before attempting to play
    const FADE_MS = 700;
    const TARGET_VOL = 0.95;

    // ELEMENTS
    const debug = document.getElementById('audio-debug');
    const overlay = document.getElementById('tap-overlay');
    const hint = document.getElementById('tap-hint');

    // STATE
    let played = false;
    let blobUrl = null;

    // Start paused (no autoplay attribute, not muted)
    const audio = new Audio(AUDIO_URL);
    audio.preload = 'auto';
    audio.loop = false;
    audio.volume = TARGET_VOL;
    audio.muted = false;
    audio.playsInline = true;
    // keep it paused initially
    try { audio.pause(); } catch(_) {}

    // fade helper
    function fadeFromTo(from, to, duration) {
      audio.volume = from;
      const delta = to - from;
      if (duration <= 0 || delta === 0) { audio.volume = to; return; }
      const step = 50;
      const steps = Math.max(1, Math.round(duration / step));
      let i = 0;
      const id = setInterval(() => {
        i++;
        audio.volume = Math.min(1, Math.max(0, from + delta * (i / steps)));
        if (i >= steps) clearInterval(id);
      }, step);
    }

    // Try to play after configured delay
    async function tryPlayAfterDelay() {
      if (played) return;
      await new Promise(r => setTimeout(r, START_DELAY_MS));
      if (played) return;
      // Attempt to play directly
      try {
        // Ensure start from 0 so user hears the start
        audio.currentTime = 0;
        const p = audio.play();
        if (p && typeof p.then === 'function') {
          await p;
          played = true;
          return;
        } else {
          // older browsers: if not paused shortly after, mark played
          setTimeout(() => { if (!audio.paused) played = true; else showOverlay(); }, 300);
        }
      } catch (err) {
        // Play was blocked by browser policy, show overlay fallback
        showOverlay();
      }
    }

    // Overlay gesture fallback: play once from start on first tap/click/keydown
    async function onFirstGesture(e) {
      if (played) return;
      if (e && e.isTrusted === false) return;
      played = true;
      hideOverlay();
      try {
        // Try to resume the existing Audio element first
        try {
          audio.currentTime = 0;
          await audio.play();
          return;
        } catch (_) {
          // fallback: fetch blob and play (ensures user gesture binding)
          const r = await fetch(AUDIO_URL, { cache: 'no-cache' });
          if (!r.ok) { showDebug('Audio fetch failed: ' + r.status + ' ' + r.statusText); return; }
          const ct = r.headers.get('content-type') || '';
          if (!/audio/i.test(ct)) { showDebug('Wrong Content-Type: ' + ct); return; }
          const b = await r.blob();
          blobUrl = URL.createObjectURL(b);
          audio.src = blobUrl;
          audio.currentTime = 0;
          audio.muted = false;
          audio.volume = 0;
          await audio.play();
          fadeFromTo(0, TARGET_VOL, FADE_MS);
          audio.addEventListener('ended', () => { if (blobUrl) { try { URL.revokeObjectURL(blobUrl); } catch(_){} blobUrl=null; } }, { once:true });
        }
      } catch (err) {
        showDebug('Play failed: ' + (err && err.message ? err.message : String(err)));
      }
    }

    function attachOverlayListeners() {
      overlay.style.display = 'block';
      overlay.setAttribute('aria-hidden','false');
      hint.style.display = 'block';
      window.addEventListener('pointerdown', onFirstGesture, { once:true, passive:true });
      window.addEventListener('keydown', onFirstGesture, { once:true, passive:true });
      window.addEventListener('focus', onFirstGesture, { once:true, passive:true });
    }
    function hideOverlay() {
      overlay.style.display = 'none';
      overlay.setAttribute('aria-hidden','true');
      hint.style.display = 'none';
      window.removeEventListener('pointerdown', onFirstGesture);
      window.removeEventListener('keydown', onFirstGesture);
      window.removeEventListener('focus', onFirstGesture);
    }

    function showOverlay() {
      if (played) return;
      attachOverlayListeners();
      // auto-hide the hint after 16s if not used
      setTimeout(()=>{ if (!played) hideOverlay(); }, 16000);
    }

    function showDebug(msg) {
      debug.textContent = msg;
      debug.style.display = 'block';
    }

    // HEAD check for server issues; shows debug if file missing or wrong MIME
    async function headCheck() {
      try {
        const r = await fetch(AUDIO_URL, { method: 'HEAD', cache: 'no-cache' });
        if (!r.ok) { showDebug('Audio HEAD failed: ' + r.status + ' ' + r.statusText); return; }
        const ct = r.headers.get('content-type') || '';
        if (!/audio/i.test(ct)) { showDebug('Wrong Content-Type: ' + ct); return; }
      } catch (err) {
        showDebug('Network check failed: ' + (err && err.message ? err.message : String(err)));
      }
    }

    // Start sequence on load
    window.addEventListener('load', () => {
      // start paused, then attempt to play after delay
      tryPlayAfterDelay();
      // show overlay after a short grace period if direct play blocked
      setTimeout(() => { if (!played) showOverlay(); }, 700);
      // quick head check for debugging
      setTimeout(headCheck, 200);
    }, { once:true });

    // cleanup blob URL on unload
    window.addEventListener('pagehide', () => { if (blobUrl) try { URL.revokeObjectURL(blobUrl); } catch(_){} blobUrl = null; });
    // expose for console
    window._aggrAudio = { audio, tryPlayAfterDelay, showOverlay, showDebug };
  })();
  </script>
</body>
</html>