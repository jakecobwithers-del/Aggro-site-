<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aggro PvP â€” Join the Fight</title>
  <style>
    /* Font */
    @font-face {
      font-family: 'DayZFont';
      src: url('28 Days Later.ttf') format('truetype');
      font-display: swap;
    }

    /* Base */
    html,body { height:100%; width:100%; margin:0; padding:0; background:#000; overflow:hidden; font-family:'DayZFont', system-ui, -apple-system, "Segoe UI", Roboto, sans-serif; }

    /* Smoke layer (video only) */
    #smoke-overlay { position:fixed; inset:0; z-index:900; pointer-events:none; }
    #smokeVideo {
      width:100%; height:100%; object-fit:cover;
      opacity:0.62; mix-blend-mode:screen;
      filter: blur(6px) saturate(1.05);
      transition: filter 180ms linear;
    }
    /* Red tint applied only to the video */
    #smokeVideo.redHue {
      filter: blur(6px) saturate(1.35) hue-rotate(-40deg) contrast(1.06);
    }

    /* Short red static flash */
    #redStatic {
      position:fixed; inset:0; z-index:1085; pointer-events:none;
      background: rgba(255,18,18,0.08); mix-blend-mode:screen; opacity:0;
      transition: opacity 100ms linear;
    }
    #redStatic.show { opacity:1; }

    /* Surge overlay containing splatters + text */
    #surgeOverlay {
      position:fixed; inset:0; z-index:1100; pointer-events:none;
      display:flex; align-items:center; justify-content:center;
      opacity:0; transition: opacity 120ms linear;
    }
    #surgeOverlay.show { opacity:1; }

    /* Dual splatters */
    .bloodSplatter { position:absolute; pointer-events:none; opacity:0.98; will-change:transform,opacity; }
    .bloodTopLeft { top:6%; left:4%; width:320px; transform:rotate(-30deg) translateZ(0); }
    .bloodBottomRight { bottom:6%; right:4%; width:360px; transform:rotate(15deg) translateZ(0); }

    /* Splat-in animation (restarts when overlay toggles) */
    #surgeOverlay.show .bloodSplatter { animation: splatIn 420ms cubic-bezier(.2,.9,.3,1) forwards; }
    @keyframes splatIn {
      0% { transform: scale(0.7) translateZ(0); opacity:0; }
      60% { transform: scale(1.15) translateZ(0); opacity:1; }
      100% { transform: scale(1) translateZ(0); opacity:0.98; }
    }

    /* Center text highly visible and animated in/out */
    #surgeOverlay h1 {
      margin:0; padding:0; pointer-events:none; z-index:1150;
      color:#ff2b2b; font-weight:900; letter-spacing:6px;
      font-size:9.5vw; line-height:1; text-align:center;
      -webkit-text-stroke:2px rgba(0,0,0,0.9);
      text-shadow: 0 2px 6px rgba(0,0,0,0.95), 0 0 18px rgba(255,40,40,0.45);
      opacity:0; transform:translateY(8px) scale(0.98);
      will-change: opacity, transform;
    }
    #surgeOverlay.show h1 { animation: textInOut 2500ms cubic-bezier(.2,.9,.3,1) forwards; }
    @keyframes textInOut {
      0%   { opacity:0; transform:translateY(12px) scale(0.98); }
      10%  { opacity:1; transform:translateY(0) scale(1.02); }
      70%  { opacity:1; transform:translateY(0) scale(1); }
      100% { opacity:0; transform:translateY(-6px) scale(0.98); }
    }

    /* Logo & UI */
    #logo { position:relative; z-index:100; text-align:center; margin-top:12vh; }
    #logo img { width:min(340px,40vw); filter:drop-shadow(0 18px 40px rgba(0,0,0,0.75)); animation: pulseLogo 2.5s ease-in-out infinite; }
    @keyframes pulseLogo { 0%{transform:scale(1)} 50%{transform:scale(1.08)} 100%{transform:scale(1)} }

    .widget-bar { position:fixed; left:50%; transform:translateX(-50%); bottom:40px; z-index:100; display:flex; flex-direction:column; gap:14px; align-items:center; }
    .redBtn, .blueBtn { color:#fff; text-decoration:none; padding:14px 26px; border-radius:10px; font-weight:800; display:inline-block; }
    .redBtn { background:#ff3b3b; }
    .blueBtn { background:#5865F2; }

    .anarchyBtn { position:fixed; top:18px; right:18px; z-index:1200; background:none; border:0; padding:0; cursor:pointer; }
    .anarchyBtn img { width:72px; height:72px; filter:drop-shadow(0 0 12px rgba(255,0,0,0.85)); }
    .anarchyMenu { position:fixed; right:18px; top:100px; z-index:1200; display:none; flex-direction:column; padding:12px; background:rgba(0,0,0,0.96); border-radius:10px; }
    .anarchyMenu.open { display:flex; }
    .anarchyMenu a { color:#fff; text-decoration:none; padding:8px 10px; border-radius:6px; font-weight:700; }

    @media (max-width:520px) {
      .bloodTopLeft { width:220px; top:4%; left:2%; }
      .bloodBottomRight { width:240px; right:2%; bottom:4%; }
      #surgeOverlay h1 { font-size:14vw; letter-spacing:3px; -webkit-text-stroke:1.6px; }
    }
  </style>
</head>
<body>
  <!-- Logo -->
  <div id="logo"><img src="Aggro-logo.PNG" alt="Aggro PvP Logo"></div>

  <!-- Buttons -->
  <div class="widget-bar">
    <a class="redBtn" href="steam://connect/103.193.80.64:3436">Connect to Server</a>
    <a class="blueBtn" href="https://discord.gg/gSwkVzJyMT" target="_blank">Join the Community</a>
  </div>

  <!-- Anarchy menu -->
  <button class="anarchyBtn" id="anarchyBtn" aria-expanded="false" aria-controls="anarchyMenu"><img src="anarchy.png" alt="Menu"></button>
  <nav id="anarchyMenu" class="anarchyMenu" aria-hidden="true">
    <a href="rules.html">Rules</a>
    <a href="support.html">Support</a>
    <a href="donate.html">Donate</a>
    <a href="killfeed.html">Kill Feed</a>
    <a href="leaderboard.html">Leaderboard</a>
  </nav>

  <!-- Smoke video (no loop attribute) -->
  <div id="smoke-overlay" aria-hidden="true">
    <video id="smokeVideo" autoplay muted playsinline preload="auto">
      <source src="Smoke.mp4?v=1" type="video/mp4">
    </video>
  </div>

  <!-- Red static flash -->
  <div id="redStatic" aria-hidden="true"></div>

  <!-- Surge overlay: two splatters + centered text -->
  <div id="surgeOverlay" aria-hidden="true">
    <img src="blood.png" class="bloodSplatter bloodTopLeft" alt="">
    <img src="blood1.png" class="bloodSplatter bloodBottomRight" alt="">
    <h1 id="joinText">JOIN THE FIGHT</h1>
  </div>

  <script>
    (function(){
      const v = document.getElementById('smokeVideo');
      const overlay = document.getElementById('surgeOverlay');
      const redStatic = document.getElementById('redStatic');
      const anarchyBtn = document.getElementById('anarchyBtn');
      const anarchyMenu = document.getElementById('anarchyMenu');

      // seconds before video end to trigger the surge
      const TRIGGER_BEFORE_END = 1.0;

      // Ensure metadata loaded (duration available) before attaching timeupdate logic
      function ensureMetadata(cb){
        if (v.duration && !isNaN(v.duration)) return cb();
        v.addEventListener('loadedmetadata', cb, { once: true });
      }

      ensureMetadata(() => {
        v.addEventListener('timeupdate', () => {
          if (!v.duration || isNaN(v.duration)) return;
          const remaining = v.duration - v.currentTime;
          if (remaining <= TRIGGER_BEFORE_END && !v._surgeTriggered) {
            v._surgeTriggered = true;
            triggerSurge();
          }
        });
      });

      // When the video ends, reset trigger and restart playback (manual loop)
      v.addEventListener('ended', () => {
        v._surgeTriggered = false;
        v.currentTime = 0;
        v.play().catch(()=>{ /* autoplay may require interaction on some browsers */ });
      });

      // Core surge: red hue on video, short red static flash, show splatters + text
      function triggerSurge(){
        // Add red hue to the video
        v.classList.add('redHue');

        // flash a short red static
        redStatic.classList.add('show');
        redStatic.setAttribute('aria-hidden','false');

        // reset overlay animations reliably by forcing reflow
        overlay.classList.remove('show');
        void overlay.offsetWidth;
        overlay.classList.add('show');
        overlay.setAttribute('aria-hidden','false');

        // remove the quick red static flash fast (punch)
        setTimeout(()=>{ redStatic.classList.remove('show'); redStatic.setAttribute('aria-hidden','true'); }, 140);

        // revert everything after the visual window (2.5s)
        setTimeout(()=>{
          v.classList.remove('redHue');
          overlay.classList.remove('show');
          overlay.setAttribute('aria-hidden','true');
        }, 2500);
      }

      // Expose manual test helper for console
      window.triggerSurge = triggerSurge;

      // Anarchy menu toggle + accessible attributes
      anarchyBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        const open = anarchyMenu.classList.toggle('open');
        anarchyMenu.setAttribute('aria-hidden', (!open).toString());
        anarchyBtn.setAttribute('aria-expanded', open.toString());
      });

      // Close menu on outside click
      document.addEventListener('click', (e) => {
        if (!e.target.closest('.anarchyBtn') && !e.target.closest('.anarchyMenu')) {
          anarchyMenu.classList.remove('open');
          anarchyMenu.setAttribute('aria-hidden','true');
          anarchyBtn.setAttribute('aria-expanded','false');
        }
      });

      // Try to start playback if browser paused it
      if (v.paused) {
        v.play().catch(()=>{ /* ignore autoplay block; manual interaction will start it */ });
      }
    })();
  </script>
</body>
</html>
