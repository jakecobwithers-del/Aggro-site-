<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aggro PvP — Join the Fight</title>
<style>
  /* CONFIG */
  :root{
    --red: #ff2b2b;
    --surge-visual-time: 2600ms; /* total visual time for headline/splats */
    --punch-time: 160ms;         /* short red static / shake punch */
    --trigger-before-end: 1.0;   /* seconds before video end to launch surge */
  }

  /* FONT */
  @font-face{
    font-family:'DayZFont';
    src: url('28 Days Later.ttf') format('truetype');
    font-display: swap;
  }

  /* BASE */
  html,body{height:100%;margin:0;background:#000;color:#fff;font-family:'DayZFont',system-ui,Segoe UI,Roboto,sans-serif;overflow:hidden}
  a{color:inherit}

  /* LAYOUT */
  #stage{position:fixed;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;z-index:60}
  #logo{margin-top:8vh}
  #logo img{width:min(360px,40vw);filter:drop-shadow(0 18px 40px rgba(0,0,0,0.75))}

  .widget-bar{position:fixed;left:50%;transform:translateX(-50%);bottom:36px;z-index:60;display:flex;flex-direction:column;gap:12px;align-items:center}
  .cta{padding:12px 24px;border-radius:10px;color:#fff;text-decoration:none;font-weight:800}
  .cta.primary{background:var(--red)}
  .cta.secondary{background:#5865F2}

  /* SMOKE VIDEO (back) */
  #smoke-overlay{position:fixed;inset:0;z-index:10;pointer-events:none}
  #smokeVideo{width:100%;height:100%;object-fit:cover;opacity:0.62;mix-blend-mode:screen;filter:blur(5px) saturate(1.05);transition:filter 160ms linear}
  #smokeVideo.redHue{filter: blur(5px) saturate(1.45) hue-rotate(-42deg) contrast(1.06)}

  /* EFFECT LAYERS */
  .effects{position:fixed;inset:0;pointer-events:none;z-index:420}
  .grain{position:absolute;inset:0;opacity:0.11;background-image:
     linear-gradient(rgba(255,255,255,0.02) 1px, transparent 1px),
     linear-gradient(90deg, rgba(255,255,255,0.02) 1px, transparent 1px);
     background-size:3px 3px,3px 3px;mix-blend-mode:overlay;animation:grain 6s steps(8) infinite}
  @keyframes grain{0%{transform:translate(0,0)}50%{transform:translate(1px,-1px)}100%{transform:translate(0,0)}}
  .vignette{position:absolute;inset:0;background:radial-gradient(ellipse at center, rgba(0,0,0,0) 30%, rgba(0,0,0,0.6) 100%);mix-blend-mode:multiply}
  .rgb-split{position:absolute;inset:0;opacity:0;mix-blend-mode:screen;transition:opacity 80ms linear;filter:contrast(1.02)}
  .rgb-split.show{opacity:1}

  /* RED STATIC FLASH */
  #redStatic{position:fixed;inset:0;z-index:600;pointer-events:none;background:linear-gradient(180deg, rgba(255,30,30,0.07), rgba(255,20,20,0.04));opacity:0;transition:opacity 80ms linear;mix-blend-mode:screen}
  #redStatic.show{opacity:1}

  /* SURGE LAYER */
  #surge{position:fixed;inset:0;z-index:700;display:flex;align-items:center;justify-content:center;pointer-events:none;opacity:0;transition:opacity 120ms linear}
  #surge.show{opacity:1}

  .blood{position:absolute;pointer-events:none;mix-blend-mode:multiply;will-change:transform,opacity,filter;filter:contrast(1.04) saturate(1.12) drop-shadow(0 10px 22px rgba(0,0,0,0.7))}
  .blood.left{top:6%;left:4%;width:420px;transform:rotate(-24deg)}
  .blood.right{bottom:6%;right:4%;width:420px;transform:rotate(10deg)}
  .blood-highlight{position:absolute;inset:0;pointer-events:none;mix-blend-mode:screen;opacity:0.14;background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,0.18), transparent 20%),
    radial-gradient(circle at 70% 70%, rgba(255,255,255,0.06), transparent 28%)}

  /* splat animations */
  #surge.show .blood{animation: splatIn 520ms cubic-bezier(.2,.9,.3,1) forwards, drip 1200ms linear 420ms both}
  @keyframes splatIn{
    0%{transform:scale(0.6) rotate(-6deg);opacity:0;filter:blur(1.2px)}
    55%{transform:scale(1.16) rotate(6deg);opacity:1;filter:blur(0.3px)}
    100%{transform:scale(1) rotate(0deg);opacity:0.98;filter:blur(0)}
  }
  @keyframes drip{0%{transform:translateY(0)}40%{transform:translateY(6px)}100%{transform:translateY(18px);opacity:0.9}}

  /* HEADLINE */
  #headline{position:relative;z-index:720;color:var(--red);font-weight:900;letter-spacing:6px;font-size:9.2vw;line-height:1;text-align:center;padding:10px 20px;-webkit-text-stroke:2px rgba(0,0,0,0.95);text-shadow:0 2px 8px rgba(0,0,0,0.9),0 0 18px rgba(255,40,40,0.35);opacity:0;transform:translateY(12px) scale(0.98);filter:drop-shadow(0 4px 18px rgba(0,0,0,0.9));will-change:opacity,transform,filter}
  /* animation controlled by JS timing so we can detect when it finishes */
  @keyframes headlinePop{
    0%{opacity:0;transform:translateY(18px) scale(0.98)}
    8%{opacity:1;transform:translateY(0) scale(1.06);filter:brightness(1.06)}
    70%{opacity:1;transform:translateY(0) scale(1)}
    100%{opacity:0;transform:translateY(-8px) scale(0.98)}
  }
  @keyframes headlineJitter{
    0%{transform:translateY(0)}
    10%{transform:translateY(-1px) translateX(1px)}
    20%{transform:translateY(0)}
    30%{transform:translateY(1px) translateX(-1px)}
    40%{transform:translateY(0)}
    100%{transform:translateY(0)}
  }

  /* RGB echo pseudo elements */
  #headline[data-text]::before,#headline[data-text]::after{content:attr(data-text);position:absolute;inset:0;z-index:-1;pointer-events:none;opacity:0;mix-blend-mode:screen}
  #headline::before{color:rgba(255,40,40,0.9);transform:translateX(-2px)}
  #headline::after{color:rgba(80,180,255,0.8);transform:translateX(2px)}

  /* small screens */
  @media(max-width:520px){
    #headline{font-size:15vw;letter-spacing:3px;-webkit-text-stroke:1.6px}
    .blood.left{width:260px;top:4%;left:2%}
    .blood.right{width:280px;right:2%;bottom:4%}
    #logo img{width:min(300px,46vw)}
  }

  /* hide utility */
  .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}
</style>
</head>
<body>

  <!-- LOGO + CTAs -->
  <div id="stage">
    <div id="logo"><img src="Aggro-logo.PNG" alt="Aggro PvP Logo"></div>
  </div>

  <div class="widget-bar">
    <a class="cta primary" href="steam://connect/103.193.80.64:3436">Connect to Server</a>
    <a class="cta secondary" href="https://discord.gg/gSwkVzJyMT" target="_blank">Join the Community</a>
  </div>

  <!-- SMOKE VIDEO -->
  <div id="smoke-overlay" aria-hidden="true">
    <video id="smokeVideo" autoplay muted playsinline preload="auto">
      <source src="Smoke.mp4?v=1" type="video/mp4">
    </video>
  </div>

  <!-- EFFECTS -->
  <div class="effects" aria-hidden="true">
    <div class="grain"></div>
    <div class="vignette"></div>
    <div class="rgb-split" id="rgbSplit"></div>
  </div>

  <!-- RED STATIC -->
  <div id="redStatic" aria-hidden="true"></div>

  <!-- SURGE LAYER -->
  <div id="surge" aria-hidden="true">
    <div class="blood left">
      <img src="blood.png" alt="" style="width:100%;height:auto;display:block">
      <div class="blood-highlight" aria-hidden="true"></div>
    </div>
    <div class="blood right">
      <img src="blood1.png" alt="" style="width:100%;height:auto;display:block">
      <div class="blood-highlight" aria-hidden="true"></div>
    </div>

    <h1 id="headline" data-text="JOIN THE FIGHT">JOIN THE FIGHT</h1>
  </div>

<script>
(function () {
  const smoke = document.getElementById('smokeVideo');
  const surge = document.getElementById('surge');
  const redStatic = document.getElementById('redStatic');
  const rgbSplit = document.getElementById('rgbSplit');
  const headline = document.getElementById('headline');

  const TRIGGER_BEFORE_END = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--trigger-before-end')) || 1.0;
  const SURGE_VISUAL_MS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--surge-visual-time')) || 2600;
  const PUNCH_MS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--punch-time')) || 160;

  // Ensure video metadata available
  function ensureMeta(cb) {
    if (smoke.duration && !isNaN(smoke.duration)) return cb();
    smoke.addEventListener('loadedmetadata', cb, { once: true });
  }

  // Launch code: trigger surge slightly before end
  ensureMeta(() => {
    smoke.addEventListener('timeupdate', () => {
      if (!smoke.duration || isNaN(smoke.duration)) return;
      const remaining = smoke.duration - smoke.currentTime;
      if (remaining <= TRIGGER_BEFORE_END && !smoke._surgeTriggered) {
        smoke._surgeTriggered = true;
        startSurgeAndHoldUntilHeadlineEnds();
      }
    });
  });

  // Manual loop restart & safety reset
  smoke.addEventListener('ended', () => {
    smoke._surgeTriggered = false;
    smoke.currentTime = 0;
    smoke.play().catch(() => {});
  });

  // Start the surge and keep all visuals until the headline animation fully ends.
  function startSurgeAndHoldUntilHeadlineEnds() {
    // 1) Red tint on video
    smoke.classList.add('redHue');

    // 2) Show small RGB split overlay and red static flash
    rgbSplit.classList.add('show');
    redStatic.classList.add('show');

    // 3) Show surge layer (restart animations)
    surge.classList.remove('show');
    void surge.offsetWidth; // force reflow to restart CSS animations
    surge.classList.add('show');
    surge.setAttribute('aria-hidden', 'false');

    // 4) quick screen shake (short)
    document.body.style.transition = 'transform 160ms cubic-bezier(.2,.9,.3,1)';
    document.body.style.transform = 'translateY(-6px) rotate(-0.35deg)';
    setTimeout(() => { document.body.style.transform = ''; }, PUNCH_MS);

    // 5) Clear the very-short punch overlays quickly so they feel like a hit,
    // but keep the main surge layer active for the full SURGE_VISUAL_MS.
    setTimeout(() => {
      redStatic.classList.remove('show');
      rgbSplit.classList.remove('show');
    }, PUNCH_MS + 10);

    // 6) Keep the surge visuals active until the headline animation is done.
    // We'll use a JS timer equal to SURGE_VISUAL_MS to ensure removal only after animation is expected to finish.
    setTimeout(() => {
      // remove visual effects
      smoke.classList.remove('redHue');
      surge.classList.remove('show');
      surge.setAttribute('aria-hidden', 'true');
      // small safety buffer before allowing next trigger
      setTimeout(() => { smoke._surgeTriggered = false; }, 200);
    }, SURGE_VISUAL_MS);
  }

  // Expose manual trigger for quick console testing
  window.triggerSurge = startSurgeAndHoldUntilHeadlineEnds;

  // Try to start playback in case browser blocked it
  if (smoke.paused) {
    smoke.play().catch(() => { /* autoplay blocked — user interaction will allow play */ });
  }
})();
</script>
</body>
</html>
