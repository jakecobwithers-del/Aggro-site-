<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aggro PvP â€” JOIN THE FIGHT (Stable Final)</title>
<style>
  :root{
    --smoke-opacity:0.56;
    --surge-ms:2200;
    --glitch-ms:420;
    --splat-opacity:1;
    --splat-scale:1.14;
  }

  /* Reliable local font loading (keep "28 Days Later.ttf" in repo root) */
  @font-face{
    font-family: "28Days";
    src: url("28%20Days%20Later.ttf?v=1") format("truetype"),
         url("28 Days Later.ttf?v=1") format("truetype");
    font-weight: 400 900;
    font-style: normal;
    font-display: swap;
  }

  html,body{
    height:100%;
    margin:0;
    background:#040404;
    color:#fff;
    font-family:"28Days", Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    overflow:hidden;
  }

  img{display:block;max-width:100%;height:auto}
  button{background:transparent;border:0;cursor:pointer;color:inherit;font:inherit}

  /* Top UI */
  .anarchyBtn{position:fixed;top:12px;right:12px;z-index:9800;padding:6px}
  .anarchyBtn img{width:52px;height:52px;display:block}
  .anarchyMenu{position:fixed;top:76px;right:12px;z-index:9800;display:none;flex-direction:column;gap:8px;padding:10px;background:linear-gradient(180deg, rgba(12,12,12,0.98), rgba(6,6,6,0.96));border-radius:10px;box-shadow:0 18px 50px rgba(0,0,0,0.6);min-width:160px;backdrop-filter:blur(6px) saturate(1.02)}
  .anarchyMenu.open{display:flex}
  .anarchyMenu a{font-family:"28Days",Inter,system-ui,Helvetica,Arial;font-weight:800;color:#ffdede;text-decoration:none;padding:10px 12px;border-radius:8px;display:block}
  .anarchyMenu a:hover{background:rgba(255,16,16,0.06);transform:translateX(-6px)}

  /* Smoke (cinematic background) */
  #smoke-wrap{position:fixed;inset:0;z-index:4000;pointer-events:none}
  #smokeVideo{width:100%;height:100%;object-fit:cover;opacity:var(--smoke-opacity);filter:blur(1.6px) saturate(1) contrast(1);will-change:transform,filter,opacity}
  #smokeVideo.glitch{transform:translateY(-6px) scale(1.02);filter:blur(3px) contrast(1.06) saturate(1.12);opacity:0.98;transition:all var(--glitch-ms) cubic-bezier(.22,.9,.3,1)}

  /* Center stage (on top of smoke) */
  .centerStage{position:fixed;inset:0;z-index:4200;pointer-events:none;display:flex;align-items:center;justify-content:center;padding:5vh 6vw}

  /* JOIN text on top of smoke: pure white core, thick dark stroke for readability */
  #joinText{
    display:inline-block;
    font-family:"28Days",Inter,system-ui,Helvetica,Arial,sans-serif;
    font-weight:900;
    font-size:clamp(28px,10vw,110px);
    line-height:0.9;
    letter-spacing:6px;
    color:#ffffff;
    -webkit-text-stroke:2px rgba(0,0,0,0.96);
    text-shadow:0 12px 36px rgba(0,0,0,0.95), 0 0 18px rgba(255,255,255,0.06);
    padding:0.36em 1.0em;
    border-radius:14px;
    backdrop-filter: blur(3px);
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    transform:translateY(20px) scale(.985);
    opacity:0;
    transition:opacity 220ms cubic-bezier(.2,.9,.3,1), transform 320ms cubic-bezier(.2,.9,.3,1), filter 220ms;
    pointer-events:none;
    z-index:4220;
    text-align:center;
    white-space:nowrap;
  }
  #joinText.visible{opacity:1;transform:translateY(0) scale(1);filter:drop-shadow(0 18px 36px rgba(0,0,0,0.75));}

  /* subtle flash behind text to boost readability during reveal */
  .joinFlash{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);pointer-events:none;width:min(86vw,1200px);height:120px;border-radius:16px;z-index:4210;background:radial-gradient(closest-side, rgba(255,255,255,0.12), rgba(255,255,255,0.02) 45%, transparent 70%);filter:blur(14px) saturate(1.05);opacity:0;transition:opacity 160ms linear}
  .joinFlash.show{opacity:1}

  /* Splatter layer sits above join text so pieces land over the text */
  .splatLayer{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(86vw,960px);height:auto;z-index:4240;pointer-events:none;overflow:visible}

  .splat-piece{position:absolute;opacity:0;transform-origin:center center;will-change:transform,opacity,filter;mix-blend-mode:multiply;filter:brightness(.9) contrast(1.05) saturate(1.05);transition:opacity 140ms linear, transform 300ms cubic-bezier(.2,.9,.28,1), filter 240ms}

  /* example piece placements relative to splatLayer */
  .sp1{left:44%; top:38%; width:220px; transform:translate(-50%,-50%) scale(.7) rotate(-12deg)}
  .sp2{left:56%; top:34%; width:260px; transform:translate(-50%,-50%) scale(.72) rotate(8deg)}
  .sp3{left:50%; top:28%; width:140px; transform:translate(-50%,-50%) scale(.6) rotate(-6deg)}
  .sp4{left:62%; top:46%; width:200px; transform:translate(-50%,-50%) scale(.68) rotate(14deg)}
  .sp5{left:48%; top:44%; width:300px; transform:translate(-50%,-50%) scale(.66) rotate(0deg)}

  .splat-piece.show{opacity:var(--splat-opacity);transform:translate(-50%,-50%) scale(var(--splat-scale)) rotate(0deg);filter:brightness(1.08) contrast(1.18) saturate(1.14) drop-shadow(0 20px 32px rgba(0,0,0,0.7))}

  .final-stain{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(86vw,960px);z-index:4250;mix-blend-mode:multiply;opacity:0;filter:brightness(.9) contrast(1.05) saturate(1.05);transition:opacity 200ms linear}
  .final-stain.show{opacity:0.98}

  /* soft red tint */
  .glitch-paint{position:fixed;inset:0;z-index:4300;pointer-events:none;opacity:0;transition:opacity 120ms linear}
  .glitch-paint.show{opacity:1}
  .red-wash{position:absolute;inset:0;background:radial-gradient(1200px 600px at 10% 20%, rgba(255,40,40,0.06), transparent 20%),linear-gradient(180deg, rgba(255,14,14,0.10), rgba(255,14,14,0.04));mix-blend-mode:overlay;filter:blur(8px) saturate(1.04);pointer-events:none}

  /* UI under visuals */
  #logo{position:fixed;top:8.5vh;left:50%;transform:translateX(-50%);z-index:3000}
  .widget-bar{position:fixed;left:50%;transform:translateX(-50%);bottom:34px;z-index:3000;display:flex;flex-direction:column;gap:12px;align-items:center}
  .cta{padding:12px 20px;border-radius:10px;color:#fff;text-decoration:none;font-weight:800;background:rgba(0,0,0,0.45)}
  .primary{background:linear-gradient(90deg,#ff4040,#ff1a1a)}.secondary{background:#5865F2}

  .hidden{display:none!important;opacity:0!important}

  /* responsive */
  @media(max-width:720px){
    .sp1{width:160px;left:42%;top:40%}
    .sp2{width:180px;left:58%;top:36%}
    .sp5{width:220px}
    #joinText{font-size:clamp(20px,12.5vw,64px);padding:0.28em 0.8em}
  }
  @media(max-width:420px){
    .sp1{width:120px;left:40%}
    .sp2{width:140px;left:60%}
    #joinText{font-size:clamp(18px,14vw,44px);letter-spacing:2px;padding:0.24em 0.6em}
  }
</style>
</head>
<body>

  <!-- Menu -->
  <button id="anarchyBtn" class="anarchyBtn" aria-expanded="false" aria-controls="anarchyMenu" title="Menu">
    <img src="anarchy.png" alt="Menu">
  </button>
  <nav id="anarchyMenu" class="anarchyMenu" aria-hidden="true" role="navigation">
    <a href="rules.html">Rules</a>
    <a href="support.html">Support</a>
    <a href="donate.html">Donate</a>
    <a href="killfeed.html">Kill Feed</a>
    <a href="leaderboard.html">Leaderboard</a>
  </nav>

  <!-- Smoke -->
  <div id="smoke-wrap" aria-hidden="true">
    <video id="smokeVideo" muted playsinline preload="auto" crossorigin="anonymous" aria-hidden="true">
      <source src="Smoke.mp4" type="video/mp4">
    </video>
  </div>

  <!-- Center stage: JOIN text (on top of smoke) + splat pieces (over text) -->
  <div class="centerStage" aria-hidden="true">
    <div class="joinFlash" id="joinFlash" aria-hidden="true"></div>

    <div id="joinText" aria-live="polite" role="status">JOIN THE FIGHT</div>

    <div class="splatLayer" id="splatLayer" aria-hidden="true">
      <img class="splat-piece sp1" id="sp1" src="blood.png" alt="">
      <img class="splat-piece sp2" id="sp2" src="blood1.png" alt="">
      <img class="splat-piece sp3" id="sp3" src="blood.png" alt="">
      <img class="splat-piece sp4" id="sp4" src="blood1.png" alt="">
      <img class="splat-piece sp5" id="sp5" src="blood.png" alt="">
      <img class="final-stain" id="finalStain" src="blood1.png" alt="">
    </div>
  </div>

  <!-- Red tint overlay -->
  <div id="glitchPaint" class="glitch-paint" aria-hidden="true"><div class="red-wash"></div></div>

  <!-- Logo + CTAs under everything -->
  <div id="logo"><img src="Aggro-logo.PNG" alt="Aggro PvP Logo"></div>
  <div class="widget-bar" role="navigation" aria-label="Quick actions">
    <a class="cta primary" href="steam://connect/103.193.80.64:3436">Connect to Server</a>
    <a class="cta secondary" href="https://discord.gg/gSwkVzJyMT" target="_blank" rel="noopener">Join Community</a>
  </div>

<script>
(function(){
  const smoke = document.getElementById('smokeVideo');
  const joinText = document.getElementById('joinText');
  const joinFlash = document.getElementById('joinFlash');
  const sp1 = document.getElementById('sp1');
  const sp2 = document.getElementById('sp2');
  const sp3 = document.getElementById('sp3');
  const sp4 = document.getElementById('sp4');
  const sp5 = document.getElementById('sp5');
  const finalStain = document.getElementById('finalStain');
  const glitchPaint = document.getElementById('glitchPaint');
  const anarchyBtn = document.getElementById('anarchyBtn');
  const anarchyMenu = document.getElementById('anarchyMenu');

  const LOOPS = Math.max(1, parseInt(getComputedStyle(document.documentElement).getPropertyValue('--loops-before-glitch')) || 1);
  const SURGE_MS = Math.max(0, parseInt(getComputedStyle(document.documentElement).getPropertyValue('--surge-ms')) || 2200);
  const GLITCH_MS = Math.max(80, parseInt(getComputedStyle(document.documentElement).getPropertyValue('--glitch-ms')) || 420);

  let prevTime = 0;
  let loopCount = 0;
  let surgeActive = false;
  let fallbackTimer = null;

  // Attempt autoplay and keep loop true
  smoke.loop = true;
  smoke.play().catch(()=>{});

  // small helpers
  function show(el){ el.classList.remove('hidden'); requestAnimationFrame(()=> el.classList.add('show')); }
  function hide(el){ el.classList.remove('show'); setTimeout(()=> el.classList.add('hidden'), 260); }

  // staged splatter sequence timed to make pieces land over the text
  function stagedSplat(){
    // ensure cleared state
    [sp1,sp2,sp3,sp4,sp5,finalStain].forEach(el=>{
      el.classList.remove('show');
      el.style.opacity = '';
    });

    // flash to boost contrast
    joinFlash.classList.add('show');
    joinText.classList.add('visible');

    // sequence timings (ms)
    const seq = [
      {el: sp3, delay: 160},
      {el: sp1, delay: 300},
      {el: sp2, delay: 420},
      {el: sp4, delay: 540},
      {el: sp5, delay: 680},
      {el: finalStain, delay: 980}
    ];

    seq.forEach(item => {
      setTimeout(()=> {
        item.el.classList.add('show');
      }, item.delay);
    });

    // fade flash quickly so join text reads under splatter
    setTimeout(()=> joinFlash.classList.remove('show'), 260);

    // hold full surge then clear visuals
    setTimeout(()=> {
      // softly remove pieces
      [sp1,sp2,sp3,sp4,sp5,finalStain].forEach((el,i)=>{
        setTimeout(()=> el.classList.remove('show'), i * 60);
      });
      joinText.classList.remove('visible');
    }, SURGE_MS + 420);
  }

  // single blended run: small smoke glitch + splatter sequence + tint
  async function runSurge(){
    if (surgeActive) return;
    surgeActive = true;

    // add visual glitch to smoke and tint
    smoke.classList.add('glitch');
    glitchPaint.classList.add('show');

    // run staged splat and join reveal
    stagedSplat();

    // remove smoke glitch after GLITCH_MS
    setTimeout(()=> {
      smoke.classList.remove('glitch');
      glitchPaint.classList.remove('show');
    }, GLITCH_MS);

    // end surge flag slightly after visuals have cleared
    setTimeout(()=> surgeActive = false, SURGE_MS + 600);
  }

  // loop-detect via timeupdate wrapback (works for looped smoke)
  smoke.addEventListener('timeupdate', ()=>{
    const t = smoke.currentTime || 0;
    if (prevTime - t > 0.28){
      loopCount++;
      if (loopCount >= (LOOPS || 1)){
        loopCount = 0;
        runSurge().catch(()=>{ /* swallow */ });
      }
    }
    prevTime = t;
  });

  // fallback interval if metadata not available
  smoke.addEventListener('loadedmetadata', ()=>{
    const dur = smoke.duration || 0;
    if (!isFinite(dur) || dur <= 0 || dur < 0.5){
      if (fallbackTimer) clearInterval(fallbackTimer);
      const estimatedLoopMs = Math.max(800, (dur > 0 ? dur : 1.0) * 1000);
      fallbackTimer = setInterval(()=> runSurge().catch(()=>{}), estimatedLoopMs + SURGE_MS + 300);
    } else {
      if (fallbackTimer){ clearInterval(fallbackTimer); fallbackTimer = null; }
    }
  });

  // Menu toggle behavior
  function openMenu(open){
    if(open){
      anarchyMenu.classList.add('open');
      anarchyMenu.setAttribute('aria-hidden','false');
      anarchyBtn.setAttribute('aria-expanded','true');
      const f = anarchyMenu.querySelector('a'); if(f) f.focus();
    } else {
      anarchyMenu.classList.remove('open');
      anarchyMenu.setAttribute('aria-hidden','true');
      anarchyBtn.setAttribute('aria-expanded','false');
    }
  }
  anarchyBtn.addEventListener('click', e=>{ e.stopPropagation(); openMenu(!anarchyMenu.classList.contains('open')); });
  document.addEventListener('click', e=>{ if(!e.target.closest('.anarchyBtn') && !e.target.closest('.anarchyMenu')) openMenu(false); });
  document.addEventListener('keydown', e=>{ if(e.key === 'Escape') openMenu(false); });

  // expose manual trigger for testing
  window.runSurge = runSurge;

  // resume playback on user interaction if autoplay blocked
  document.addEventListener('click', ()=>{ if (smoke.paused) smoke.play().catch(()=>{}); });

  // init
  (async function init(){ try { smoke.currentTime = 0; await smoke.play(); } catch(e){} })();

})();
</script>
</body>
</html>
