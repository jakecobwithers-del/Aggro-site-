<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aggro PvP — JOIN with staged blood splatter</title>
<style>
  :root{
    --smoke-opacity:0.56;
    --surge-ms:2200;
    --glitch-ms:420;
    --splat-opacity:1;
  }

  /* Font (use your TTF in repo root) */
  @font-face{
    font-family: "28Days";
    src: url("28%20Days%20Later.ttf?v=7") format("truetype"),
         url("28 Days Later.ttf?v=7") format("truetype");
    font-weight: 400 900;
    font-style: normal;
    font-display: swap;
  }

  html,body{
    height:100%;
    margin:0;
    background:#050505;
    color:#fff;
    font-family:"28Days",Inter,system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    -webkit-font-smoothing:antialiased;
    overflow:hidden;
  }

  /* layout and stacking:
     - smoke (z-4000)
     - join container (z-4200)
     - blood splat pieces (z-4300) — rendered over the join text
     - UI/menu above everything (z-9600)
  */
  .anarchyBtn{position:fixed;top:14px;right:14px;z-index:9600;padding:6px}
  .anarchyBtn img{width:56px;height:56px;display:block}
  .anarchyMenu{position:fixed;top:84px;right:14px;z-index:9600;display:none;flex-direction:column;gap:8px;padding:10px;background:linear-gradient(180deg,rgba(12,12,12,0.98),rgba(6,6,6,0.96));border-radius:12px;box-shadow:0 14px 40px rgba(0,0,0,0.6)}
  .anarchyMenu.open{display:flex}
  .anarchyMenu a{font-family:"28Days",Inter,system-ui,Helvetica,Arial;font-weight:800;color:#ffdede;text-decoration:none;padding:10px;border-radius:8px;display:block}

  /* Smoke (cinematic overlay) */
  #smoke-wrap{position:fixed;inset:0;z-index:4000;pointer-events:none}
  #smokeVideo{width:100%;height:100%;object-fit:cover;opacity:var(--smoke-opacity);filter:blur(1.6px) saturate(1) contrast(1)}

  /* Join container on top of smoke */
  #joinContainer{
    position:fixed;
    inset:0;
    z-index:4200;
    display:flex;
    align-items:center;
    justify-content:center;
    pointer-events:none;
    padding:5vh 6vw;
  }

  /* The JOIN text — visually strong but not obstructed */
  #joinText{
    position:relative;
    z-index:4220;
    display:inline-block;
    font-size:clamp(28px,10vw,96px);
    line-height:0.92;
    letter-spacing:6px;
    font-weight:900;
    color:#fff;
    -webkit-text-stroke:1.8px rgba(0,0,0,0.96);
    text-shadow:0 12px 36px rgba(0,0,0,0.95), 0 0 12px rgba(255,255,255,0.06);
    padding:0.36em 1.0em;
    border-radius:12px;
    background:linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.06));
    backdrop-filter: blur(4px) saturate(1.02);
    transform: translateY(16px) scale(.99);
    opacity:0;
    transition:opacity 220ms cubic-bezier(.2,.9,.3,1), transform 300ms cubic-bezier(.2,.9,.3,1);
    pointer-events:none;
    white-space:nowrap;
  }
  #joinText.visible{opacity:1;transform: translateY(0) scale(1);}

  /* Blood splatter pieces container — sits above the text so pieces appear to land on it */
  .splat-stage{
    position:absolute;
    z-index:4300;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width: min(86vw,1000px);
    height: auto;
    pointer-events:none;
    overflow:visible;
  }

  /* We'll use multiple splat piece images positioned with absolute coordinates.
     Each piece animates from scale(0.6)+translateY(-8px)+rotate(-15..15deg) to scale(1)+translateY(0)+rotate(0)
     with staggered delays for the "drip then spread then stain" feel.
  */
  .splat-piece{
    position:absolute;
    width:auto;
    height:auto;
    opacity:0;
    transform-origin:center;
    mix-blend-mode:multiply; /* darken the white text behind it slightly, choose multiply for realistic blood */
    filter:contrast(1.08) saturate(1.08) brightness(.95);
    transition:opacity 180ms linear;
    will-change:opacity,transform,filter;
  }

  /* Example placements relative to .splat-stage (adjust to fit your splat image) */
  /* Piece 1: center-left drip */
  .p1{ left:36%; top:32%; width:220px; transform: translate(-50%,-50%) scale(.6) rotate(-12deg) translateY(-8px); opacity:0; filter:brightness(.9); }
  /* Piece 2: center-right blob */
  .p2{ left:54%; top:28%; width:240px; transform: translate(-50%,-50%) scale(.6) rotate(8deg) translateY(-12px); opacity:0; filter:brightness(.9); }
  /* Piece 3: top-left scatter */
  .p3{ left:28%; top:18%; width:140px; transform: translate(-50%,-50%) scale(.6) rotate(-6deg) translateY(-6px); opacity:0; filter:brightness(.85); }
  /* Piece 4: bottom-right drip */
  .p4{ left:62%; top:48%; width:200px; transform: translate(-50%,-50%) scale(.6) rotate(15deg) translateY(-10px); opacity:0; filter:brightness(.92); }
  /* Piece 5: mid stain for coverage */
  .p5{ left:50%; top:38%; width:300px; transform: translate(-50%,-50%) scale(.6) rotate(0deg) translateY(-6px); opacity:0; filter:brightness(.88); }

  /* visible state applied by JS to each piece */
  .splat-piece.show{
    opacity:var(--splat-opacity);
    transform: translate(-50%,-50%) scale(1) rotate(0deg) translateY(0);
    filter:brightness(1.12) contrast(1.18) saturate(1.08) drop-shadow(0 18px 30px rgba(0,0,0,0.7));
    transition: transform 420ms cubic-bezier(.2,.9,.28,1), opacity 160ms linear, filter 260ms;
  }

  /* Final overall stain overlay to darken/readjust color across text after pieces land */
  .final-stain{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width: min(86vw,1000px);
    height:auto;
    z-index:4320;
    pointer-events:none;
    opacity:0;
    transition:opacity 240ms linear;
    mix-blend-mode:multiply;
    filter:brightness(.92) contrast(1.05) saturate(1.05);
  }
  .final-stain.show{opacity:0.98}

  /* subtle glow flash to help readability when splat lands */
  .flash{
    position:absolute;
    left:50%;
    top:50%;
    transform:translate(-50%,-50%);
    width: min(86vw,1000px);
    height:120px;
    z-index:4210;
    pointer-events:none;
    opacity:0;
    background:radial-gradient(closest-side, rgba(255,255,255,0.12), transparent 45%);
    border-radius:12px;
    transition:opacity 180ms linear;
  }
  .flash.show{opacity:1}

  /* small responsive adjustments */
  @media(max-width:520px){
    .p1{ width:140px; left:34%; top:34% }
    .p2{ width:160px; left:56%; top:30% }
    .p3{ width:92px; left:24%; top:20% }
    .p4{ width:140px; left:64%; top:52% }
    .p5{ width:200px; left:50%; top:40% }
    #joinText{font-size:clamp(18px,14vw,48px); padding:0.28em 0.6em}
  }
</style>
</head>
<body>

  <!-- Menu (unchanged) -->
  <button id="anarchyBtn" class="anarchyBtn" aria-expanded="false" aria-controls="anarchyMenu" title="Menu">
    <img src="anarchy.png" alt="Menu">
  </button>
  <nav id="anarchyMenu" class="anarchyMenu" aria-hidden="true" role="navigation">
    <a href="rules.html">Rules</a>
    <a href="support.html">Support</a>
    <a href="donate.html">Donate</a>
    <a href="killfeed.html">Kill Feed</a>
    <a href="leaderboard.html">Leaderboard</a>
  </nav>

  <!-- Smoke (under everything except UI) -->
  <div id="smoke-wrap"><video id="smokeVideo" muted playsinline preload="auto" crossorigin="anonymous"><source src="Smoke.mp4" type="video/mp4"></video></div>

  <!-- Join container (text visible above smoke) -->
  <div id="joinContainer">
    <div class="flash" id="flash"></div>
    <div id="joinText" aria-live="polite" role="status">JOIN THE FIGHT</div>

    <!-- splat-stage placed relative to join container so pieces align with the text -->
    <div class="splat-stage" id="splatStage" aria-hidden="true">
      <!-- Use the same blood.png file but we place it multiple times and mask/clip visually by size/position.
           If you prefer, replace these src values with trimmed piece PNGs for more realistic fragments.
      -->
      <img class="splat-piece p1" id="p1" src="blood.png" alt="">
      <img class="splat-piece p2" id="p2" src="blood1.png" alt="">
      <img class="splat-piece p3" id="p3" src="blood.png" alt="">
      <img class="splat-piece p4" id="p4" src="blood1.png" alt="">
      <img class="splat-piece p5" id="p5" src="blood.png" alt="">
      <img class="final-stain" id="finalStain" src="blood1.png" alt="">
    </div>
  </div>

  <!-- UI under visuals -->
  <div id="logo"><img src="Aggro-logo.PNG" alt="Aggro PvP Logo"></div>
  <div class="widget-bar" style="position:fixed;left:50%;transform:translateX(-50%);bottom:34px;z-index:9600">
    <a class="cta primary" href="steam://connect/103.193.80.64:3436">Connect to Server</a>
    <a class="cta secondary" href="https://discord.gg/gSwkVzJyMT" target="_blank">Join Community</a>
  </div>

<script>
(function(){
  const smoke = document.getElementById('smokeVideo');
  const joinText = document.getElementById('joinText');
  const flash = document.getElementById('flash');
  const p1 = document.getElementById('p1');
  const p2 = document.getElementById('p2');
  const p3 = document.getElementById('p3');
  const p4 = document.getElementById('p4');
  const p5 = document.getElementById('p5');
  const finalStain = document.getElementById('finalStain');

  // play smoke loop
  smoke.loop = true;
  smoke.play().catch(()=>{});

  // helper to show join text immediately and then run splatter sequence
  function showJoinThenSplat(){
    // show text
    joinText.classList.add('visible');
    // small flash to help readability
    flash.classList.add('show');

    // clear any prior states
    [p1,p2,p3,p4,p5,finalStain].forEach(el=>{
      el.classList.remove('show');
      el.style.opacity = 0;
      el.style.transform = el.style.transform; // noop to force repaint if needed
    });

    // staged timings (in ms)
    const timings = [
      {el: p3, delay: 180},  // small scatter first
      {el: p1, delay: 320},  // left drip
      {el: p2, delay: 420},  // main right blob
      {el: p4, delay: 520},  // bottom-right drip
      {el: p5, delay: 640},  // central stain / spread
      {el: finalStain, delay: 980} // final overall stain overlay to darken
    ];

    // reveal each piece with a slight sound of "landing" feel (staggered)
    timings.forEach(item=>{
      setTimeout(()=>{
        item.el.classList.add('show');
      }, item.delay);
    });

    // fade the flash quickly so text reads under splat
    setTimeout(()=> flash.classList.remove('show'), 260);

    // keep join text visible for the surge duration then fade
    const SURGE_MS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--surge-ms')) || 2200;
    setTimeout(()=> {
      // remove pieces gracefully
      [p1,p2,p3,p4,p5,finalStain].forEach((el,i)=>{
        setTimeout(()=> el.classList.remove('show'), i*60);
      });
      joinText.classList.remove('visible');
    }, SURGE_MS + 420);
  }

  // Public run: shows join then splatter. You can call runSurge() to trigger.
  async function runSurge(){
    // visual micro-glitch on smoke (brief)
    smoke.classList.add('glitch');
    // show join+splatter sequence
    showJoinThenSplat();
    // short hold then remove glitch class
    const GLITCH_MS = parseInt(getComputedStyle(document.documentElement).getPropertyValue('--glitch-ms')) || 420;
    setTimeout(()=> smoke.classList.remove('glitch'), GLITCH_MS);
  }

  // Loop trigger: use a manual call or hook into smoke loop detection.
  // We'll attempt to detect the smoke looping (works if Smoke.mp4 is a tight loop).
  let prevTime = 0, loopCount = 0;
  smoke.addEventListener('timeupdate', ()=>{
    const t = smoke.currentTime || 0;
    if (prevTime - t > 0.28){
      loopCount++;
      // run on first loop (adjust as you like)
      if (loopCount >= 1){
        loopCount = 0;
        runSurge();
      }
    }
    prevTime = t;
  });

  // Fallback: if metadata missing, run on interval
  smoke.addEventListener('loadedmetadata', ()=>{
    const dur = smoke.duration || 0;
    if (!isFinite(dur) || dur <= 0 || dur < 0.5){
      setInterval(()=> runSurge(), 3000);
    }
  });

  // Allow manual trigger for testing in console: runSurge()
  window.runSurge = runSurge;

  // init attempt to start playback
  (async function init(){ try{ smoke.currentTime = 0; await smoke.play(); }catch(e){} })();

})();
</script>
</body>
</html>
