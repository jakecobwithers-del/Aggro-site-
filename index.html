<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aggro PvP â€” Smoke Overlay</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

    :root{ --crimson:#ff4444; --bg-deep:#0f0000; }

    html,body{height:100%;margin:0;padding:0;font-family:'Share Tech Mono',monospace;background:#000;color:#e0e0e0;}
    body{
      display:flex;align-items:center;justify-content:center;min-height:100vh;position:relative;overflow:hidden;
      background:radial-gradient(circle at 30% 20%, rgba(0,0,0,1) 0%, var(--bg-deep) 80%);
    }

    /* UI */
    .center{position:relative;z-index:10;text-align:center;padding:40px;pointer-events:auto}
    .logo{width:70%;max-width:320px;display:block;margin:0 auto 18px}
    .btn{display:inline-block;padding:10px 18px;border-radius:8px;background:#111;color:var(--crimson);text-decoration:none;border:2px solid rgba(255,68,68,0.12);margin:8px}

    /* Canvas overlay sits above everything but doesn't block clicks */
    #smokeCanvas{
      position:fixed;inset:0;z-index:9999;pointer-events:none;display:block;
      width:100%;height:100%;
    }

    /* Menu / sidebar (kept above UI controls) */
    .menu-toggle{ position:fixed; top:18px; left:16px; z-index:110; background:transparent; color:var(--crimson); border:2px solid rgba(255,68,68,0.12); padding:8px 10px; border-radius:6px; font-size:18px; cursor:pointer; }
    .sidebar{ position:fixed; top:62px; left:16px; z-index:110; display:flex; flex-direction:column; gap:10px; transform:translateX(-8px) scale(.98); opacity:0; transition:transform .22s ease,opacity .22s ease; pointer-events:none; }
    .sidebar.open{ transform:translateX(0) scale(1); opacity:1; pointer-events:auto; }
    .sidebar a{ display:inline-block; text-decoration:none; color:var(--crimson); background:rgba(0,0,0,0.6); padding:8px 12px; border-radius:6px; font-weight:700; border:1px solid rgba(255,68,68,0.18); box-shadow:0 2px 8px rgba(0,0,0,0.6); }

    @media(max-width:520px){
      .logo{width:80%}
      .btn{min-width:160px}
    }
  </style>
</head>
<body>

  <!-- Canvas overlay (topmost visual layer, pointer-events:none so UI stays clickable) -->
  <canvas id="smokeCanvas" aria-hidden="true"></canvas>

  <!-- UI -->
  <button class="menu-toggle" id="menuBtn" aria-expanded="false" aria-controls="sidebar">&#9776;</button>
  <nav id="sidebar" class="sidebar" aria-hidden="true">
    <a href="mods.html">&#9881; Mods</a>
    <a href="rules.html">&#128220; Rules</a>
    <a href="killfeed.html">&#128128; Killfeed</a>
    <a href="leaderboard.html">&#127942; Leaderboard</a>
  </nav>

  <main class="center" id="mainUI">
    <img src="Aggro-logo.PNG" alt="Aggro PvP Logo" class="logo" />
    <div>
      <a class="btn" href="steam://connect/193.193.80.64:3436">ðŸŽ® Connect to Server</a>
      <a class="btn" href="https://discord.gg/gSwkVzJyMT" target="_blank" rel="noopener">ðŸ’¬ Join Discord</a>
    </div>
  </main>

  <script>
  /*
    Improved canvas smoke overlay
    - Requires: transparent Smoke.png and Aggro-logo.PNG in same folder (case-sensitive)
    - Paste this file to your site root and hard-refresh
    - Controls: press "S" to toggle overlay; use window.__AggroSmoke API from console
  */

  (function(){
    const canvas = document.getElementById('smokeCanvas');
    const ctx = canvas.getContext('2d', { alpha: true });
    const img = new Image();
    img.src = 'Smoke.png';
    img.crossOrigin = 'anonymous';

    // Layer configuration: tune scale, speed, alpha, horizontal drift (horizSpeed) and turbulence (turb)
    const layers = [
      { offset: 0, speed: 0.18, scale: 1.05, alpha: 0.92, horizSpeed: 6, turb: 14 },
      { offset: 0, speed: 0.10, scale: 1.30, alpha: 0.82, horizSpeed: -3, turb: 24 },
      { offset: 0, speed: 0.06, scale: 1.60, alpha: 0.72, horizSpeed: 2, turb: 34 }
    ];

    let width = 0, height = 0;
    let last = 0, tAccum = 0;
    let playing = true;

    // Device pixel ratio throttle for mobile
    function getTargetDPR() {
      const w = window.innerWidth;
      const isMobile = w < 800;
      return isMobile ? Math.min(1.5, window.devicePixelRatio || 1) : Math.min(2, window.devicePixelRatio || 1);
    }

    function resize() {
      width = window.innerWidth;
      height = window.innerHeight;
      const dpr = getTargetDPR();
      canvas.width = Math.floor(width * dpr);
      canvas.height = Math.floor(height * dpr);
      canvas.style.width = width + 'px';
      canvas.style.height = height + 'px';
      ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
    }
    window.addEventListener('resize', resize);
    resize();

    // cheap deterministic noise for turbulence
    function noise(seed) { return (Math.sin(seed * 12.9898) * 43758.5453) % 1; }

    // Offscreen cache for each layer
    const cache = [];
    img.onload = () => {
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      layers.forEach((L, i) => {
        const cw = Math.ceil(img.width * L.scale);
        const ch = Math.ceil(img.height * L.scale);
        const c = document.createElement('canvas');
        c.width = cw * dpr;
        c.height = ch * dpr;
        const cc = c.getContext('2d');
        cc.setTransform(dpr, 0, 0, dpr, 0, 0);
        cc.drawImage(img, 0, 0, cw, ch);
        cache[i] = c;
        L.offset = (i * (ch / 2)) % ch;
      });
    };
    img.onerror = () => console.warn('Smoke image failed to load. Ensure Smoke.png exists and path is correct.');

    function clear() { ctx.clearRect(0,0,width,height); }

    function drawLayer(layer, dt, tAccum, cacheCanvas){
      const dpr = Math.max(1, window.devicePixelRatio || 1);
      const baseImgW = cacheCanvas ? (cacheCanvas.width / dpr) : img.width;
      const baseImgH = cacheCanvas ? (cacheCanvas.height / dpr) : img.height;
      const layerW = baseImgW * layer.scale;
      const layerH = baseImgH * layer.scale;

      const vpx = layer.speed * height;
      layer.offset = (layer.offset - vpx * (dt / 1000)) % layerH;

      const baseXShift = Math.sin((tAccum / 1000) * (layer.horizSpeed / 3)) * (layer.horizSpeed * 6);
      const turbShift = (noise(tAccum * 0.001 + layer.scale) - 0.5) * layer.turb;
      const drawX = (width / 2) - layerW / 2 + baseXShift + turbShift;

      ctx.globalAlpha = layer.alpha;
      ctx.globalCompositeOperation = 'screen';

      for (let y = -layerH + layer.offset; y < height + layerH; y += layerH) {
        if (cacheCanvas) ctx.drawImage(cacheCanvas, drawX, y, layerW, layerH);
        else ctx.drawImage(img, drawX, y, layerW, layerH);
      }

      ctx.globalAlpha = 1;
      ctx.globalCompositeOperation = 'source-over';
    }

    // subtle tint/bloom pass after drawing layers
    function bloomPass() {
      ctx.save();
      ctx.globalCompositeOperation = 'lighter';
      ctx.globalAlpha = 0.055;
      ctx.fillStyle = 'rgba(220,40,60,1)';
      ctx.fillRect(0,0,width,height);
      ctx.restore();
    }

    function animate(now) {
      if (!last) last = now;
      const dt = now - last || 16;
      last = now;
      tAccum += dt;

      clear();
      if (playing) {
        for (let i = layers.length - 1; i >= 0; i--) {
          drawLayer(layers[i], dt, tAccum, cache[i]);
        }
        bloomPass();
      }
      requestAnimationFrame(animate);
    }
    requestAnimationFrame(animate);

    // Toggle overlay with S
    function togglePlaying() {
      playing = !playing;
      canvas.style.display = playing ? 'block' : 'none';
    }
    window.addEventListener('keydown', (e) => { if (e.key === 's' || e.key === 'S') togglePlaying(); });

    // Small UI wiring for sidebar/menu
    const btn = document.getElementById('menuBtn');
    const sidebar = document.getElementById('sidebar');
    btn.addEventListener('click', ()=> {
      const open = sidebar.classList.toggle('open');
      sidebar.setAttribute('aria-hidden', !open);
      btn.setAttribute('aria-expanded', open);
    });
    document.addEventListener('click', (e)=> {
      const inside = e.target.closest('#sidebar') || e.target.closest('#menuBtn');
      if (!inside && sidebar.classList.contains('open')) sidebar.classList.remove('open');
    });

    // Runtime API for quick tuning
    window.__AggroSmoke = {
      toggle(){ togglePlaying(); },
      setLayerAlpha(i,v){ if(layers[i]) layers[i].alpha = v; },
      setLayerSpeed(i,v){ if(layers[i]) layers[i].speed = v; },
      hide(){ playing = false; canvas.style.display = 'none'; },
      show(){ playing = true; canvas.style.display = 'block'; }
    };

  })();
  </script>
</body>
</html>
