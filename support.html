<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aggro PvP — Friend Avatars</title>
<style>
  @font-face{font-family:28DaysLater;src:url('assets/fonts/28DaysLater.ttf') format('truetype');font-display:swap}
  :root{--accent:#ff3c3c;--muted:#bdbdbd}
  *{box-sizing:border-box}
  body{margin:0;font-family:28DaysLater,system-ui,Arial;background:#0b0b0b;color:#fff;min-height:100vh}
  header{padding:20px;text-align:center}
  h1{margin:0;color:var(--accent);font-size:28px}
  .container{max-width:1100px;margin:24px auto;padding:20px;background:rgba(255,255,255,0.03);border-radius:10px}
  .controls{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:14px}
  .controls input, .controls select, .controls button, .controls textarea{padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.3);color:#fff}
  .controls input[type="text"]{min-width:180px}
  .controls textarea{min-width:300px;min-height:80px;max-width:100%;resize:vertical}
  .grid{display:flex;flex-wrap:wrap;gap:12px}
  .card{width:calc(25% - 9px);min-width:200px;background:rgba(255,255,255,0.03);padding:12px;border-radius:10px;display:flex;align-items:center;gap:12px}
  .avatar{width:72px;height:72px;border-radius:10px;background:#111;border:1px solid rgba(255,255,255,0.04);object-fit:cover}
  .meta{flex:1;min-width:0}
  .name{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .sub{font-size:13px;color:var(--muted);margin-top:6px}
  .actions a{color:var(--accent);text-decoration:underline;font-size:13px}
  .note{font-size:13px;color:var(--muted);margin-top:12px}
  @media(max-width:900px){.card{width:calc(50% - 9px)}}
  @media(max-width:520px){.card{width:100%}.controls{flex-direction:column}}
  .error{color:#ffbbbb;background:rgba(255,0,0,0.06);padding:8px;border-radius:6px;margin-top:8px}
</style>
</head>
<body>
<header>
  <h1>Aggro PvP — Friend Avatars (manual)</h1>
</header>

<main class="container" role="main">
  <div class="controls" aria-label="Add friend">
    <input id="input-name" type="text" placeholder="Display name (optional)" />
    <input id="input-id" type="text" placeholder="User ID (numeric)" />
    <input id="input-discrim" type="text" placeholder="Discriminator (e.g., 1234) — optional" />
    <input id="input-avatar-hash" type="text" placeholder="Avatar hash (a_... or hex) — optional" />
    <input id="input-avatar-url" type="text" placeholder="Direct avatar URL (optional)" />
    <button id="btn-add">Add Friend</button>
    <button id="btn-clear">Clear All</button>
  </div>

  <div style="margin-bottom:10px">
    <label style="display:block;font-size:13px;color:var(--muted)">Or paste a JSON array here (example shown below) and click Load JSON</label>
    <textarea id="json-area" placeholder='[{"id":"123","avatar":"a_hash","username":"Name"}]'></textarea>
    <div style="margin-top:8px">
      <button id="btn-load-json">Load JSON</button>
    </div>
  </div>

  <div id="errors" class="error" style="display:none"></div>

  <div id="grid" class="grid" aria-live="polite"></div>

  <div class="note">
    How to get avatar hash: if you have a profile avatar URL already, the hash is the filename part before extension. If you don't have the hash, supply user ID + discriminator to show Discord default embed avatar.
    If a friend has a custom avatar and you don't have the hash, ask them to paste their avatar URL or user ID+avatar hash here.
  </div>
</main>

<script>
(function(){
  const grid = document.getElementById('grid');
  const nameIn = document.getElementById('input-name');
  const idIn = document.getElementById('input-id');
  const discrimIn = document.getElementById('input-discrim');
  const hashIn = document.getElementById('input-avatar-hash');
  const urlIn = document.getElementById('input-avatar-url');
  const btnAdd = document.getElementById('btn-add');
  const btnClear = document.getElementById('btn-clear');
  const jsonArea = document.getElementById('json-area');
  const btnLoadJson = document.getElementById('btn-load-json');
  const errors = document.getElementById('errors');

  const items = []; // { id, avatarHash, username, discriminator, avatarUrl }

  function esc(s){ return String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

  function avatarUrlFromParts(id, hash, discrim){
    if (hash && id){
      // choose ext based on hash prefix a_ => gif else png
      const ext = hash.startsWith('a_') ? 'gif' : 'png';
      return `https://cdn.discordapp.com/avatars/${id}/${hash}.${ext}?size=256`;
    }
    if (id && discrim){
      const d = parseInt(discrim,10) || 0;
      const idx = d % 5;
      return `https://cdn.discordapp.com/embed/avatars/${idx}.png`;
    }
    return '';
  }

  function addItem(obj){
    // obj: { id, avatarHash, avatarUrl, username, discriminator }
    const id = obj.id || '';
    const username = obj.username || (id ? `User ${id}` : 'Unknown');
    const avatarUrl = obj.avatarUrl || avatarUrlFromParts(obj.id, obj.avatarHash, obj.discriminator) || '';
    items.push({ id, username, avatarUrl });
    renderGrid();
  }

  function renderGrid(){
    grid.innerHTML = '';
    errors.style.display = 'none';
    if (!items.length){
      grid.innerHTML = '<div style="color:var(--muted);padding:16px">No profiles added yet.</div>';
      return;
    }
    items.forEach(it=>{
      const card = document.createElement('div'); card.className = 'card';
      // build avatar element; if avatarUrl empty show placeholder
      const avatarSrc = it.avatarUrl || blankDataUri(it.username);
      card.innerHTML = `
        <img class="avatar" src="${esc(avatarSrc)}" alt="${esc(it.username)} avatar" onerror="this.onerror=null;this.src='${blankDataUri(it.username)}'"/>
        <div class="meta"><div class="name">${esc(it.username)}</div><div class="sub">${it.id ? 'ID: ' + esc(it.id) : ''}</div></div>
        <div class="actions"><a href="${it.id?('https://discord.com/users/'+encodeURIComponent(it.id)):'#'}" target="_blank" rel="noopener noreferrer">Profile</a></div>
      `;
      grid.appendChild(card);
    });
  }

  function blankDataUri(name){
    const initial = (name||'?').trim().charAt(0).toUpperCase();
    const svg = `<svg xmlns='http://www.w3.org/2000/svg' width='256' height='256'><rect width='100%' height='100%' fill='%23222'/><text x='50%' y='55%' font-size='120' fill='%23fff' text-anchor='middle' dominant-baseline='middle'>${initial}</text></svg>`;
    return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
  }

  btnAdd.addEventListener('click', ()=>{
    const id = idIn.value.trim();
    const username = nameIn.value.trim() || (id ? 'User ' + id.slice(-4) : '');
    const avatarHash = hashIn.value.trim();
    const avatarUrl = urlIn.value.trim();
    const discriminator = discrimIn.value.trim();
    if (!id && !avatarUrl){
      showError('Provide at least a User ID or direct avatar URL.');
      return;
    }
    const obj = { id: id || '', avatarHash: avatarHash || '', avatarUrl: avatarUrl || '', username: username || '', discriminator: discriminator || '' };
    addItem(obj);
    // clear inputs (except name)
    idIn.value=''; hashIn.value=''; urlIn.value=''; discrimIn.value='';
  });

  btnClear.addEventListener('click', ()=>{
    items.length = 0;
    renderGrid();
  });

  btnLoadJson.addEventListener('click', ()=>{
    const raw = jsonArea.value.trim();
    if (!raw){ showError('Paste a JSON array first'); return; }
    try{
      const arr = JSON.parse(raw);
      if (!Array.isArray(arr)) throw new Error('JSON must be an array of objects');
      arr.forEach(o=>{
        // accept keys: id, avatar, avatarHash, avatarUrl, username, discriminator
        const id = o.id || o.userId || '';
        const avatarHash = o.avatarHash || o.avatar || o.avatar_hash || '';
        const avatarUrl = o.avatarUrl || o.avatar_url || '';
        const username = o.username || o.name || '';
        const discriminator = o.discriminator || o.discrim || '';
        addItem({ id, avatarHash, avatarUrl, username, discriminator });
      });
      jsonArea.value = '';
    }catch(e){
      showError('Invalid JSON: ' + e.message);
    }
  });

  function showError(msg){
    errors.style.display='block'; errors.textContent = msg;
  }

  // initial render
  renderGrid();

  // Expose for console convenience
  window.AggroAvatars = {
    add: addItem,
    list: ()=>items
  };
})();
</script>
</body>
</html>
