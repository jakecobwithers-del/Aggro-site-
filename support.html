<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aggro PvP Support</title>

  <style>
    @font-face {
      font-family: '28DaysLater';
      src: url('assets/fonts/28 Days Later.ttf') format('truetype');
      font-weight: normal;
      font-style: normal;
      font-display: swap;
    }

    :root{
      --accent:#ff3c3c;
      --overlay-bg: rgba(0,0,0,0.82);
      --muted:#bdbdbd;
      --widget-width:360px;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{
      font-family:'28DaysLater', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color:#fff;
      background:#000;
    }

    /* Video background */
    #smoke-bg{position:fixed;inset:0;width:100%;height:100%;object-fit:cover;z-index:-2;filter:grayscale(6%) contrast(1) brightness(0.45)}
    .bg-tint{position:fixed;inset:0;z-index:-1;background:linear-gradient(180deg, rgba(0,0,0,0.45) 0%, rgba(0,0,0,0.65) 60%, rgba(0,0,0,0.85) 100%);pointer-events:none}

    .wrap{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:4vh 20px}
    .card{width:100%;max-width:1100px;background:var(--overlay-bg);border-radius:12px;padding:28px;box-shadow:0 10px 40px rgba(0,0,0,0.6);display:grid;grid-template-columns:1fr 380px;gap:22px;align-items:start}
    @media (max-width:880px){.card{grid-template-columns:1fr;padding:20px;gap:14px}}

    h1{margin:0 0 10px 0;font-size:48px;color:var(--accent);text-shadow:0 6px 18px rgba(0,0,0,0.9);line-height:0.95}
    .lead{margin:0 0 16px 0;font-size:18px;line-height:1.5;color:#fff;opacity:0.95}
    ul{margin:0 0 16px 1.1rem;padding:0}
    li{margin:8px 0;font-size:16px;line-height:1.5}

    .discord-links{background:rgba(255,255,255,0.03);border-left:6px solid var(--accent);padding:14px;border-radius:8px}
    .discord-title{display:flex;gap:10px;align-items:center;margin:0 0 8px 0;font-size:20px;color:var(--accent)}
    .small{font-size:13px;color:var(--muted);margin-top:6px}
    footer{margin-top:12px;font-size:13px;color:var(--muted)}

    .right-col{display:flex;flex-direction:column;gap:14px;align-items:stretch}
    .discord-iframe{width:100%;max-width:var(--widget-width);min-height:300px;height:320px;border-radius:8px;border:0;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,0.6)}

    .profiles{display:flex;flex-direction:column;gap:8px;max-width:var(--widget-width)}
    .profile{display:flex;gap:10px;align-items:center;background:rgba(255,255,255,0.02);padding:8px 10px;border-radius:8px;border:1px solid rgba(255,255,255,0.02)}
    .avatar{width:46px;height:46px;border-radius:6px;background:#222;flex:0 0 46px;overflow:hidden;display:inline-block;object-fit:cover;border:1px solid rgba(255,255,255,0.04)}
    .profile .meta{display:flex;flex-direction:column;min-width:0}
    .profile .name{font-size:15px;color:#fff;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .profile .tag{font-size:13px;color:var(--muted)}
    .profile a.link{margin-left:auto;color:var(--accent);text-decoration:underline;font-size:13px}

    .skeleton{background:linear-gradient(90deg, rgba(255,255,255,0.03) 0%, rgba(255,255,255,0.06) 50%, rgba(255,255,255,0.03) 100%);animation:shine 1.2s linear infinite;border-radius:6px}
    @keyframes shine{from{background-position:-200px 0} to{background-position:200px 0}}
    .muted-note{font-size:13px;color:var(--muted);margin-top:8px}

    .channel-links{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
    .channel-links a{background:rgba(255,255,255,0.04);padding:8px 12px;border-radius:999px;color:#fff;text-decoration:none;border:1px solid rgba(255,255,255,0.02);font-size:14px}

    .bottom-widget{max-width:1100px;margin:18px auto 40px;display:flex;justify-content:center}
  </style>
</head>
<body>
  <video id="smoke-bg" autoplay muted loop playsinline>
    <source src="assets/smoke.mp4" type="video/mp4">
    Your browser does not support the video background.
  </video>
  <div class="bg-tint" aria-hidden="true"></div>

  <main class="wrap" role="main">
    <section class="card" aria-labelledby="support-heading">
      <div>
        <h1 id="support-heading">SUPPORT & SURVIVAL</h1>

        <p class="lead">If you're still breathing, we've got your back. All official support for Aggro PvP is handled through our Discord channels. Provide as much detail as possible when reporting issues.</p>

        <ul>
          <li><strong>#ticket</strong> â€” For direct help and admin support</li>
          <li><strong>#bug-reports</strong> â€” Found a glitch, exploit, or issue?</li>
          <li><strong>#suggestions</strong> â€” Got ideas to improve the server?</li>
        </ul>

        <div class="discord-links" aria-labelledby="homage-heading">
          <div class="discord-title" id="homage-heading">ðŸŽ– Homage to Day Z Legends</div>
          <p class="small">Aggro PvP stands on the shoulders of giants. Huge respect to the creators and visionaries behind Day Z:</p>

          <div class="profiles" id="featured-profiles">
            <div class="profile skeleton" style="height:60px;"></div>
            <div class="profile skeleton" style="height:60px;"></div>
          </div>

          <p class="muted-note">Profiles pulled from your Discord server widget when enabled. If not visible, ensure the Server Widget is enabled and member privacy settings allow display.</p>
        </div>

        <div style="margin-top:14px">
          <div class="channel-links" aria-hidden="false">
            <a id="open-server" href="https://discord.com/channels/1375728051194957874" target="_blank" rel="noopener noreferrer">Open Aggro PvP Server</a>
            <a id="link-ticket" href="https://discord.com/channels/1375728051194957874/1385079306350493766" target="_blank" rel="noopener noreferrer">#ticket</a>
            <a id="link-bug" href="https://discord.com/channels/1375728051194957874/1385078265236160563" target="_blank" rel="noopener noreferrer">#bug-reports</a>
            <a id="link-suggestions" href="https://discord.com/channels/1375728051194957874/1385461796437233695" target="_blank" rel="noopener noreferrer">#suggestions</a>
          </div>
        </div>

        <footer>
          &copy; 2025 Aggro PvP. All rights reserved. Not affiliated with Bohemia Interactive.
        </footer>
      </div>

      <aside class="right-col" aria-label="Discord">
        <iframe id="discord-widget" class="discord-iframe" title="Aggro PvP Discord Widget"
          src="https://discord.com/widget?id=1375728051194957874&theme=dark"
          allowtransparency="true"
          sandbox="allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts">
        </iframe>

        <div style="max-width:var(--widget-width);">
          <div style="font-size:14px;color:var(--muted);margin-bottom:6px">Direct links to featured members</div>
          <div id="profiles-list" class="profiles" aria-live="polite">
            <div class="profile skeleton" style="height:60px;"></div>
          </div>
        </div>
      </aside>
    </section>
  </main>

  <div class="bottom-widget">
    <iframe title="Aggro PvP small widget" src="https://discord.com/widget?id=1375728051194957874&theme=dark" class="discord-iframe" style="height:140px;max-width:720px"></iframe>
  </div>

  <script>
    (function(){
      const GUILD_ID = '1375728051194957874';
      const MAX_SHOW = 8;
      const endpoint = `https://discord.com/api/guilds/${GUILD_ID}/widget.json`;
      const container = document.getElementById('profiles-list');
      const featured = document.getElementById('featured-profiles');

      // Fetch widget.json with retries
      function fetchWidget(retries = 4, delay = 800){
        return new Promise((resolve, reject) => {
          function attempt(n){
            fetch(endpoint, {cache:'no-store'}).then(r=>{
              if (!r.ok) throw new Error('widget not available');
              return r.json();
            }).then(json => resolve(json)).catch(err=>{
              if (n > 0) setTimeout(()=>attempt(n-1), delay);
              else reject(err);
            });
          }
          attempt(retries);
        });
      }

      fetchWidget().then(data => {
        const members = Array.isArray(data.members) ? data.members.slice(0, MAX_SHOW) : [];
        if (!members.length){
          container.innerHTML = '<div class="small">No visible widget members right now. Members may be offline or hidden by privacy settings.</div>';
          featured.innerHTML = '<div class="small">No featured members available.</div>';
          return;
        }

        container.innerHTML = '';
        featured.innerHTML = '';

        function avatarUrl(m){
          if (m.avatar && m.id){
            const isAnimated = m.avatar.startsWith('a_');
            const ext = isAnimated ? 'gif' : 'png';
            return `https://cdn.discordapp.com/avatars/${m.id}/${m.avatar}.${ext}?size=128`;
          }
          return 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128"><rect width="100%" height="100%" fill="%23222"/><text x="50%" y="55%" dominant-baseline="middle" text-anchor="middle" fill="%23fff" font-size="48">?</text></svg>';
        }

        members.forEach(member=>{
          const el = document.createElement('div'); el.className = 'profile';
          const safeName = escapeHtml(member.username);
          el.innerHTML = `
            <img class="avatar" src="${avatarUrl(member)}" alt="${safeName} avatar" />
            <div class="meta"><div class="name">${safeName}</div><div class="tag">${member.status?escapeHtml(member.status):'online'}</div></div>
            <a class="link" href="https://discord.com/users/${member.id}" target="_blank" rel="noopener noreferrer">View</a>
          `;
          container.appendChild(el);

          const lower = (member.username||'').toLowerCase();
          if (lower.includes('rbskizza') || lower.includes('slomobob')) {
            featured.appendChild(el.cloneNode(true));
          }
        });

        if (!featured.querySelector('.profile')) {
          const known = [
            {id:'', name:'rbskizza'},
            {id:'', name:'slomobob'}
          ];
          featured.innerHTML = '';
          known.forEach(k=>{
            const row = document.createElement('div'); row.className = 'profile';
            row.innerHTML = `<div class="avatar" style="display:flex;align-items:center;justify-content:center;color:#fff;font-size:14px">${k.name.charAt(0)}</div>
              <div class="meta"><div class="name">${escapeHtml(k.name)}</div><div class="tag">external</div></div>
              <a class="link" href="${k.id?('https://discord.com/users/'+k.id):('https://discord.com/search?query='+encodeURIComponent(k.name))}" target="_blank" rel="noopener noreferrer">View</a>`;
            featured.appendChild(row);
          });
        }
      }).catch(err=>{
        container.innerHTML = '<div class="small">Could not load Discord widget. Ensure Server Widget is enabled and you have permission to view it.</div>';
        featured.innerHTML = '<div class="small">Could not load widget data.</div>';
        console.warn('widget error', err);
      });

      function escapeHtml(s){ if(!s) return ''; return s.replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }
    })();
  </script>
</body>
</html>